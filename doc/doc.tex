\section{ドキュメントの構成}
作成したドキュメント(\url{https://github.com/open-rdc/nav_tuning_guide})の構成は以下の要素から構成されている. 
また, 作成にあたってROS WikiのNavigationページを参考にした.
\cite{ros_wiki_navigation}
\begin{itemize}
     \item \textbf{自己位置推定(AMCL)}
     \begin{itemize}
        \item \textbf{必要最小限の設定}
        \item \textbf{主要パラメータの調整}
        \item \textbf{その他パラメータの調整}
        \item \textbf{ROS\_ERRORが出たときの問題と対処法}
    \end{itemize}
     \item \textbf{経路計画(Move Base)}
    \begin{itemize}
        \item \textbf{必要最小限の設定}
        \item \textbf{Move Baseの基本となるパラメータ調整}
        \item \textbf{リカバリ動作のパラメータ調整}
        \item \textbf{コストマップのパラメータ調整}
        \item \textbf{ローカルプランナーのパラメータ調整}
        \item \textbf{グローバルプランナーのパラメータ調整}
        \item \textbf{ROS\_WARNが出たときの問題と対処法}
    \end{itemize}
\newpage
     \item \textbf{地図}
    \begin{itemize}
        \item \textbf{地図作成方法に関して}
        \item \textbf{slam\_toolboxでの地図作成方法}
        \item \textbf{glimでの地図作成方法}
        \item \textbf{大規模屋外環境での地図解像度設定}
    \end{itemize}
    \item \textbf{オドメトリ}
    \begin{itemize}
        \item \textbf{オドメトリの調整手順}
    \end{itemize}     
\end{itemize}

\section{ドキュメントの例}
本論文では, 作成したドキュメントの中から例として, オドメトリ調整と自己位置推定(AMCL), 地図の
3項目を取り上げ, 記載内容の一部を示す. 

\subsection{オドメトリ調整}
調整対象のパラメータは, 車輪半径に関する補正係数であるwheel\_radius\_multiplierと, 車輪環距離に関する補正係数であるwheel\_separation\_multiplierの2つである. 
これらはロボットのオドメトリの正確さに直結するため, 自己位置推定を行う上で最初に調整すべき項目である. 

調整手順は以下の通りである. まず, Rvizを用いてトピックの可視化の準備を行う. 固定座標系をodomに設定し, LaserScanトピックを表示することで, ロボットの移動に伴うセンサ計測をできるようにする. 

次に, ロボットを壁から数メートル離れた位置に配置し, 直進させて並進成分の正確さを確認する. 
このとき, 得られるレーザスキャンに厚みが生じる場合は, wheel\_radius\_multiplierを調整する. 

さらに, ロボットをその場で回転させ, 回転成分の正確さを確認する. 
スキャンが1〜2度以上ずれている場合は, wheel\_separation\_multiplierを調整する. 
最後に再度直進させ, 並進と回転の双方でスキャンが一致していることを確認した時点で調整を完了とする. 

\figref{fig:Scanvisualizedinrviz}にオドメトリ調整前後のレーザスキャンをRvizで可視化した様子を示す. 
\begin{figure}[h]
     \centering
     \begin{minipage}[c]{65mm}
         \centering
         \includegraphics[height=40mm]{images/before_odom.png}
         \subcaption{Before odometry adjustment}
     \end{minipage}
     \begin{minipage}[c]{65mm}
         \centering
         \includegraphics[height=40mm]{images/after_odom.png}
         \subcaption{After odometry adjustment}
     \end{minipage}
     \caption{Scan visualized in Rviz}
     \label{fig:Scanvisualizedinrviz}
\end{figure}

\subsection{AMCLにおけるオドメトリ関連パラメータの調整}
自己位置推定に用いるAMCLにおいて, 最初に調整すべきパラメータはodom\_alpha1〜odom\_alpha4である. 
これらはオドメトリの信頼度を決定する値であり, 大きな値を設定すると, オドメトリに含まれるノイズが大きいとみなされ, オドメトリの影響が小さくなる. 
一方で, 小さな値を設定するとオドメトリを強く信頼するようになる. 屋外環境ではオドメトリ誤差が大きくなるため, パラメータを過度に小さくすると誤推定に繋がる危険がある. 
特にodom\_alpha2とodom\_alpha3の調整が有効である. 

調整方法は以下の通りである. まず, 走行データをrosbagで記録し, Rvizを用いてパーティクルの散らばりや自己位置のずれ方を可視化する. 
これにより, どのパラメータが問題に寄与しているかを予測できる. その後, 記録したデータを再生し, パラメータを変更しながらオフラインでAMCLを動作させることで, パーティクルの挙動を確認できる. 

調整の基準としては, スキャンデータと地図の対応関係を利用する. 例えば, スキャンが並進方向にずれる場合はodom\_alpha3を増加させることで改善できる. 
また, 回転方向にずれる場合はodom\_alpha2を増加させることで修正を試みる. 
自己位置が徐々にずれていく場合には, odom\_alpha1〜odom\_alpha4させることで安定化を図る. 
特に, alpha2とalpha3の調整が有効である. 

調整完了の基準としては, コントローラ操作時のrosbagを再生した際に自己位置の破綻がなく, かつ実ロボットによる自律走行においてもゴールまで破綻なく移動できることである. 

さらに, AMCLの調整においては, 地図とオドメトリのどちらを信頼するかというトレードオフが存在する. 
地図が高精度で環境と一致している場合には, スキャンマッチングが有効に働くため, odom\_alphaを大きめに設定しても安定した推定が得られる. 
一方で, 地図の精度が低い場合や環境変動が大きい場合には, オドメトリを相対的に信頼する方が安定する. 
ただし, オドメトリへの依存度を上げすぎると, 特に屋外環境では累積誤差によって自己位置が破綻する危険がある. 
このように, 状況に応じてバランスを取ることが, AMCLのパラメータ調整の難しさであるといえる. 

\figref{fig:ScanandMap}にAMCL調整前後のレーザスキャンと地図をRvizで可視化した様子を示す.
\begin{figure}[h]
     \centering
     \begin{minipage}[c]{65mm}
         \centering
         \includegraphics[height=40mm]{images/scanmap_before.png}
         \subcaption{Before AMCL adjustment}
     \end{minipage}
     \begin{minipage}[c]{65mm}
         \centering
         \includegraphics[height=40mm]{images/scanmap_after.png}
         \subcaption{After AMCL adjustment}
     \end{minipage}
     \caption{Map and scan visualized in Rviz}
     \label{fig:ScanandMap}
\end{figure}

\subsection{大規模屋外環境での地図解像度設定}
つくばチャレンジ\cite{つくばチャレンジ}のような大規模な屋外環境における自律移動では, 
使用する地図の総セル数が非常に大きくなる. このとき, 経路計画で用いられる Dijkstra 法の計算量は, 
地図の総セル数に強く依存する. そのため, セル数が増大すると計算負荷が高まり, 
ロボットが停止を繰り返すなどの問題が生じることがある. 実際に, 
つくばチャレンジ2025の初回実験走行では, 計算領域が過大であったために, 
ロボットが断続的に停止する様子が確認された. 

ROSのmap\_serverが扱う地図は格子状のセルで構成されており, 1セルが表す物理距離は
解像度(resolution)によって定義される. 解像度を大きく設定すると, 1セルあたりの距離が
広がり, 結果として地図全体のセル数が減少する. 例えば, resolutionを0.10から0.20に変更した
場合, 格子は荒くなるが, 総セル数は大きく減少し, 経路計画の計算速度は向上する. 
\tabref{tab:resolution_comparison}に異なる解像度における特性の比較を示す. 
\begin{table}[htbp]
  \centering
  \caption{Comparison of characteristics for diﬀerent map resolutions}
  \label{tab:resolution_comparison}
  \begin{tabular}{lcc}
    \hline
    & \textbf{Low resolution} & \textbf{High resolution} \\
    \hline
    Grid granularity & Fine & Coarse \\
    Number of total cells & Large & Small \\
    Computational cost & High & Low \\
    \hline
  \end{tabular}
\end{table}

つくばチャレンジ2025においては, 地図のスケールを調整した. 
その結果を, \tabref{tab:tsukuba2025_map_scale}に示す. 総計算領域を約65\%削減することができた. 
この削減により, Dijkstra 法による経路探索の計算量が大幅に低減し, ロボットが停止を繰り返す問題を解消することができた. 
\figref{Fig:beforemap}, \figref{Fig:aftermap}にスケールを統一した調整前, 調整後の地図を示す. 

ただし, 解像度を過度に大きくすると, 地図が粗くなり, 自己位置推定が不安定になったり, 
狭い通路がセルの粗さによって潰され, 通行不可能と判断される場合がある. そのため, 
解像度は単に大きくすればよいというものではないことを注意する必要がある. 
\begin{table}[htbp]
  \centering
  \caption{Comparison of Map Scale Adjustment in Tsukuba Challenge 2025}
  \label{tab:tsukuba2025_map_scale}
  \begin{tabular}{lccc}
    \hline
     & Image size [pixel] & Total number of cells & resolution \\
    \hline
    Before adjustment & 7077 $\times$ 3773 & Approx.\ 26.69 million & 0.10 \\
    After adjustment  & 4163 $\times$ 2219 & Approx.\ 9.24 million & 0.17 \\
    \hline
  \end{tabular}
\end{table}

\begin{figure}[hbtp]
  \centering
 \includegraphics[keepaspectratio, scale=0.05]
      {images/tsukuba_all_2_edit_12_edit_14.png}
 \caption{Map before adjustment}
 \label{Fig:beforemap}
\end{figure}
\begin{figure}[hbtp]
  \centering
 \includegraphics[keepaspectratio, scale=0.05]
      {images/tsukuba_all_2_edit_12_edit_14_re_17.png}
 \caption{Map after adjustment}
 \label{Fig:aftermap}
\end{figure}

